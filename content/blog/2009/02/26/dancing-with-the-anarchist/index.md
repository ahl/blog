---
title: "Dancing with the Anarchist"
date: "2009-02-26"
categories: 
  - "fishworks"
---

Barry Burke, the [Storage Anarchist](http://thestorageanarchist.typepad.com/weblog/), has written an [interesting roundup ("don't miss the amazing vendor flash dance")](http://thestorageanarchist.typepad.com/weblog/2009/02/1039-dont-miss-the-amazing-vendor-flash-dance.html) covering the flash strategies of some players in the server and storage spaces. Sun's position on flash comes out a bit mangled, but Barry can certainly be forgiven for missing the mark since Sun hasn't always communicated its [position](http://dtrace.org/blogs/ahl/hsp_goes_glossy) well. Allow me to clarify our version of the flash dance.

Barry's conclusion that Sun sees flash as well-suited for the server isn't wrong — of course it's harder to drive high IOPS and low latency outside a single box. However we've also proven not only that we see a big role for flash in storage, but that we're innovating in that realm with the [Hybrid Storage Pool (HSP)](http://dtrace.org/blogs/ahl/hybrid_storage_pools_in_cacm) an architecture that seamlessly integrates flash into the storage hierarchy. Rather than a [Ron Popeil-esque](http://www.theregister.co.uk/2004/07/08/dtrace_user_take/) sales pitch, let me take you through the genesis of the HSP.

The HSP is something we started to develop a bit over two years ago. By January of 2007, we had identified that a ZFS intent-log device using flash would greatly improve the performance of the nascent Sun Storage 7000 series in a way that was simpler and more efficient that some other options. We started getting our first flash SSD samples in February of that year. With SSDs on the brain, we started contemplating other uses and soon came up with the idea of using flash as a secondary caching tier between the DRAM cache (the ZFS ARC) and disk. We dubbed this the [L2ARC](http://blogs.sun.com/brendan/entry/test).

At that time we knew that we'd be using mostly 7200 RPM disks in the 7000 series. Our primary goal with flash was to greatly improve the performance of synchronous writes and we addressed this with the flash log device that we call Logzilla. With the L2ARC we solved the other side of the performance equation by improving read IOPS by leaps and bounds over what hard drives of any rotational speed could provide. By August of 2007, [Brendan](http://blogs.sun.com/brendan) had put together the initial implementation of the L2ARC, and, combined with some early SSD samples — Readzillas — our initial enthusiasm was borne out. Yes, it's a caching tier so some workloads will do better than others, but customers have been very pleased with their results.

These two distinct uses of flash comprise the Hybrid Storage Pool. In April 2008 we gave our [first public talk about the HSP](http://blocksandfiles.com/article/5400) at the IDF in Shanghai, and a year and a bit after Brendan's proof of concept we shipped the [7410 with Logzilla and Readzilla](http://dtrace.org/blogs/ahl/fishworks_launch). It's important to note that this system achieves remarkable price/performance through its marriage of commodity disks with flash. Brendan has done a terrific job of [demonstrating the performance enabled by the HSP on that system](http://blogs.sun.com/brendan/entry/l2arc_screenshots).

While we were finishing the product, the WSJ [reported](http://www.australianit.news.com.au/story/0,24897,23054788-5013040,00.html) that EMC was starting to use flash drives into their products. I was somewhat deflated initially until it became clear that EMC's solution didn't integrate flash into the storage hierarchy nearly as seamlessly or elegantly as we had with the HSP; instead they had merely replaced their fastest, most expensive drives with faster and even more expensive SSDs. I'll disagree with the Storage Anarchist's conclusion: EMC did not start the flash revolution nor are they leading the way (though I don't doubt they are, as Barry writes, "Taking Our Passion, And Making It Happen"). EMC though has done a great service to the industry by extolling the virtues of SSDs and, presumably, to EMC customers by providing a faster tier for HSM.

In the same article, Barry alludes to some of the problems with EMC's approach using SSDs from STEC:

> _STEC rates their ZeusIOPS drives at something north of 50,000 read IOPS each, but as I have explained before, this is a misleading number because it’s for 512-byte blocks, read-only, without the overhead of RAID protection. A more realistic expectation is that the drives will deliver somewhere around 5-6000 4K IOPS (4K is a more typical I/O block size)._

The Hybrid Storage Pool [avoids the bottlenecks associated with a tier 0 approach](http://dtrace.org/blogs/ahl/shadow_of_hsp), drives much higher IOPS, scales, and makes highly efficient economical use of the resources from flash to DRAM and disk. Further, I think we'll be able to debunk this [notion](http://thestorageanarchist.typepad.com/weblog/2009/02/1042-modular-storage-whats-in-a-name.html) that the enterprise needs its own class of flash devices by architecting commodity flash to build an enterprise solution. There are a lot of horses in this race; Barry has clearly already picked his, but the rest of you may want survey the field.
